function wipYoutubeRun(e,i,t){function o(){var e=t[0].createElement("script");e.src="https://www.youtube.com/iframe_api";var i=t[0].getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}o(),i.onYouTubeIframeAPIReady=function(){e.$broadcast("youtubeApiReady"),i.ytLoaded=!0}}function wipYoutubeUtilsService(){var e=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,i={getYoutubeId:function(i){return i.match(e)[2]},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?!0:!1}};return i}function wipYoutubeToggleDirective(){return{restrict:"EA",require:"^wipYoutube",link:function(e,i,t,o){i[0].addEventListener("click",function(){var e=o.player.getPlayerState();switch(e){case 5:o.player.playVideo();break;case 1:o.player.pauseVideo();break;case 2:o.player.playVideo()}})}}}function wipYoutubePauseDirective(){return{restrict:"EA",require:"^wipYoutube",link:function(e,i,t,o){i[0].addEventListener("click",function(){o.player.pauseVideo()})}}}function wipYoutubePlayDirective(){return{restrict:"EA",require:"^wipYoutube",link:function(e,i,t,o){i[0].addEventListener("click",function(){o.player.playVideo()})}}}function wipYoutubeSizedPlayDirective(){return{restrict:"EA",require:"^wipYoutube",link:function(e,i,t,o){i[0].addEventListener("click",function(){o.openSizedMode()})}}}function wipYoutubeStopDirective(){return{restrict:"EA",require:"^wipYoutube",link:function(e,i,t,o){i[0].addEventListener("click",function(){o.player.stopVideo()})}}}function wipYoutubeDirective(e,i,t,o){return{restrict:"EA",transclude:!0,template:'<div class="video-wrapper {{vm.playerState}}" ng-class="{\'sized\' : vm.sizedMode,\'player-ready\':vm.playerIsReady}">\n    <div></div>\n    <div class="fallback-image"></div>\n    <div ng-if="vm.options.type===\'background\'" class="transclude-content" ng-transclude></div>\n    <div ng-show="vm.sizedMode" ng-click="vm.closeSizedMode()" class="sized-close-button">&#10006;</div>\n</div>',scope:{videoUrl:"=",options:"=?",playerCallback:"&?"},controllerAs:"vm",compile:function(i,a,n){return function(i,a,n,r){r.el=a,r.videoUrl=i.videoUrl,o.$on("youtubeApiReady",function(){r.init()}),e.ytLoaded&&t(function(){r.init()},0)}},controller:["$scope","$rootScope","wipYoutubeUtils",function(o,a,n){function r(){z.playerIsReady=!1,z.playerState="",z.videoId=z.utils.getYoutubeId(z.videoUrl),z.playerId="wip-youtube-player-"+Math.random().toString(36).slice(2)+"-"+z.videoId,z.el.children().eq(0).children().eq(0).attr("id",z.playerId),z.options=o.options?angular.merge(V,o.options):V,l(),d()}function l(){z.options.fallbackImage!==!1&&(z.options.fallbackImage&&""!==z.options.fallbackImage||(z.options.fallbackImage="//img.youtube.com/vi/"+z.videoId+"/maxresdefault.jpg"),u())}function u(){z.el.children().eq(0).children().eq(1)[0].style.backgroundImage="url("+z.options.fallbackImage+")",z.el.children().eq(0).children().eq(1)[0].style.backgroundSize="cover",z.el.children().eq(0).children().eq(1)[0].style.backgroundPosition="center center"}function d(){var i=angular.copy(z.options.playerVars);"background"===z.options.type?(z.el.addClass("background-mode"),z.el.removeClass("default-mode"),i.controls=0):(z.el.removeClass("background-mode"),z.el.addClass("default-mode")),z.player=new e.YT.Player(z.playerId,{videoId:z.videoId,playerVars:i,events:{onReady:y,onStateChange:v,onApiChange:w}})}function p(){k=z.el[0].clientWidth,I=z.el[0].clientHeight,$=z.player.a.clientWidth,M=z.player.a.clientHeight,S=z.player.a.width/z.player.a.height}function c(e){z.player.a&&(!z.player.isMuted||z.player.isMuted()||z.sizedMode||z.player.mute(),p(),I/k>M/$?($=Math.ceil(I*S),z.player.a.style.width=$+"px",z.player.a.style.height=I+"px",z.player.a.style.transform="translate3d("+(k-$)/2+"px,0,0)"):(M=Math.ceil(k/S),z.player.a.style.width=k+"px",z.player.a.style.height=M+"px",z.player.a.style.transform="translate3d(0,"+(I-M)/2+"px,0)"),z.options.mobile&&1===z.options.playerVars.autoplay&&z.player&&z.player.playVideo&&z.player.playVideo(),e&&e())}function s(e){p(),M=Math.ceil(k/S),z.player.a.style.width=k+"px",z.player.a.style.height=M+"px",z.player.a.style.transform="",e&&e()}function y(){t(function(){P&&P({player:z.player}),b(function(){f()})})}function f(){z.playerIsReady=!0,o.$emit("wipYoutube:player-ready",z)}function b(e){if("background"===z.options.type){if(!z.options.mobile&&z.isMobile()&&z.player.a&&(o.$emit("wipYoutube:mobile-fallback",z),z.playerIsReady=!1,z.playerState="",z.player.destroy()),z.options.mobile&&!z.player.a||!z.isMobile()&&!z.player.a)return void r();t(function(){c(e)},0)}else s(e);o.$emit("wipYoutube:video-updated",z)}function v(i){1===z.options.playerVars.autoplay&&0===i.data&&z.player.seekTo(z.options.playerVars.start),-1===i.data&&b(),angular.forEach(e.YT.PlayerState,function(e,t){i.data===e&&o.$apply(function(){z.playerState="player-state-"+t.toLowerCase()})})}function w(){}function g(){o.$apply(function(){z.sizedMode=!0,z.player.playVideo(),z.player.unMute()}),o.$emit("wipYoutube:size-mode-on",z)}function m(){z.sizedMode=!1,z.player.mute(),0===z.options.playerVars.autoplay?z.player.pauseVideo():z.player.playVideo(),o.$emit("wipYoutube:size-mode-off",z)}function h(e,i){i=i||400,D&&t.cancel(D),D=t(function(){e()},i)}function Y(e){z.sizedMode&&27===e.keyCode&&o.$apply(function(){m()})}var k,I,$,M,S,z=this,V={type:"background",fallbackImage:null,mobile:!1,playerVars:{autoplay:0,controls:0,iv_load_policy:3,cc_load_policy:0,fs:1,modestbranding:1,playsinline:1,disablekb:0,rel:0,showinfo:0,wmode:"opaque",branding:0,autohide:0,start:0}},P=o.playerCallback;z.options,z.playerIsReady=!1,z.utils=n,z.playerState,z.sizedMode=!1,z.videoId,z.playerId,z.init=r,z.isMobile=z.utils.isMobile,z.initModes=b,z.openSizedMode=g,z.closeSizedMode=m;var D=!0;o.$watch("options",function(e,i){angular.isDefined(e)&&e!==i&&z.player.destroy&&h(function(){z.player.a&&z.player.destroy(),r()})},!0),o.$watch("videoUrl",function(e,i){angular.isDefined(e)&&e!==i&&(z.videoUrl=e,z.videoId=z.utils.getYoutubeId(z.videoUrl),l(),z.player.loadVideoById(z.videoId))}),o.$on("wip-youtube-player:update",function(){h(function(){b()})}),o.$watch(function(){return{width:z.el[0].clientWidth,height:z.el[0].clientHeight}},function(e,i){angular.isDefined(e)&&e!==i&&z.playerIsReady&&t(function(){h(function(){b()})})},!0),angular.element(window).on("resize",function(){z.sizedMode&&o.$apply(function(){m()}),t(function(){h(function(){b()})})}),i.on("keydown",Y),o.$on("$destroy",function(){i.off("keydown",Y),o.$destroy()})}]}}wipYoutubeDirective.$inject=["$window","$document","$timeout","$rootScope"],wipYoutubeRun.$inject=["$rootScope","$window","$document"],angular.module("wipYoutube",[]).directive("wipYoutube",wipYoutubeDirective).directive("wipYoutubeToggle",wipYoutubeToggleDirective).directive("wipYoutubePause",wipYoutubePauseDirective).directive("wipYoutubePlay",wipYoutubePlayDirective).directive("wipYoutubeSizedPlay",wipYoutubeSizedPlayDirective).directive("wipYoutubeStop",wipYoutubeStopDirective).factory("wipYoutubeUtils",wipYoutubeUtilsService).run(wipYoutubeRun);